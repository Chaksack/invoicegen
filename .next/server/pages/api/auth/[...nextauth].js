"use strict";(()=>{var e={};e.id=748,e.ids=[748],e.modules={8432:e=>{e.exports=require("bcryptjs")},9344:e=>{e.exports=require("jsonwebtoken")},3227:e=>{e.exports=require("next-auth")},3598:e=>{e.exports=require("next-auth/providers/google")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2930:e=>{e.exports=import("@auth/sequelize-adapter")},8210:e=>{e.exports=import("sequelize")},6249:(e,a)=>{Object.defineProperty(a,"l",{enumerable:!0,get:function(){return function e(a,t){return t in a?a[t]:"then"in a&&"function"==typeof a.then?a.then(a=>e(a,t)):"function"==typeof a&&"default"===t?a:void 0}}})},7692:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{config:()=>c,default:()=>u,routeModule:()=>d});var n=t(1802),o=t(7153),s=t(6249),i=t(3857),l=e([i]);i=(l.then?(await l)():l)[0];let u=(0,s.l)(i,"default"),c=(0,s.l)(i,"config"),d=new n.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/auth/[...nextauth]",pathname:"/api/auth/[...nextauth]",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},409:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{Dv:()=>l,gk:()=>s});var n=t(8210),o=e([n]);let s=new(n=(o.then?(await o)():o)[0]).Sequelize(process.env.DB_NAME||"invoicegen",process.env.DB_USER||"postgres",process.env.DB_PASSWORD||"postgres",{host:process.env.DB_HOST||"localhost",port:parseInt(process.env.DB_PORT||"5432"),dialect:"postgres",logging:!1,dialectOptions:{ssl:{require:!0,rejectUnauthorized:!1}}}),i=async(e=5,a=5e3)=>{let t=0;for(;t<e;)try{return await s.authenticate(),console.log("Database connection has been established successfully."),!0}catch(r){if(t++,console.error(`Unable to connect to the database (attempt ${t}/${e}):`,r),t>=e)return console.error("Maximum connection attempts reached. Database connection failed."),console.error("CRITICAL: Database connection failed in production environment"),!1;console.log(`Retrying in ${a/1e3} seconds...`),await new Promise(e=>setTimeout(e,a))}return!1},l=async()=>{try{if(!await i())return console.error("Database connection failed after multiple retries"),!1;return t(1897),t(2198),await s.sync({alter:!1}),console.log("Database synchronized successfully."),!0}catch(e){return console.error("Error synchronizing database:",e),console.error("CRITICAL: Database synchronization failed in production environment"),!1}};r()}catch(e){r(e)}})},2198:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{default:()=>u});var n=t(8210),o=t(409),s=t(1897),i=e([n,o,s]);[n,o,s]=i.then?(await i)():i;let l=o.gk.define("Invoice",{id:{type:n.DataTypes.UUID,defaultValue:n.DataTypes.UUIDV4,primaryKey:!0},invoiceNumber:{type:n.DataTypes.STRING,allowNull:!0},invoiceDate:{type:n.DataTypes.DATEONLY,allowNull:!1,defaultValue:n.DataTypes.NOW},dueDate:{type:n.DataTypes.DATEONLY,allowNull:!0},logoUrl:{type:n.DataTypes.STRING,allowNull:!0},sender:{type:n.DataTypes.JSONB,allowNull:!1,defaultValue:{name:"",address:"",city:"",postalCode:"",country:""}},recipient:{type:n.DataTypes.JSONB,allowNull:!1,defaultValue:{name:"",address:"",city:"",postalCode:"",country:""}},items:{type:n.DataTypes.JSONB,allowNull:!1,defaultValue:[]},currency:{type:n.DataTypes.STRING,allowNull:!1,defaultValue:"USD"},taxRate:{type:n.DataTypes.FLOAT,allowNull:!1,defaultValue:0},subtotal:{type:n.DataTypes.FLOAT,allowNull:!1,defaultValue:0},total:{type:n.DataTypes.FLOAT,allowNull:!1,defaultValue:0},UserId:{type:n.DataTypes.UUID,allowNull:!1,references:{model:"Users",key:"id"}}},{timestamps:!0,hooks:{beforeCreate:e=>{let a=e.items.reduce((e,a)=>e+a.quantity*a.unitPrice,0),t=e.taxRate/100*a;e.subtotal=a,e.total=a+t},beforeUpdate:e=>{if(e.changed("items")||e.changed("taxRate")){let a=e.items.reduce((e,a)=>e+a.quantity*a.unitPrice,0),t=e.taxRate/100*a;e.subtotal=a,e.total=a+t}}}});s.default.hasMany(l),l.belongsTo(s.default);let u=l;r()}catch(e){r(e)}})},1897:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{default:()=>c});var n=t(8210),o=t(8432),s=t.n(o),i=t(409),l=e([n,i]);[n,i]=l.then?(await l)():l;let u=i.gk.define("User",{id:{type:n.DataTypes.UUID,defaultValue:n.DataTypes.UUIDV4,primaryKey:!0},email:{type:n.DataTypes.STRING,allowNull:!1,unique:!0,validate:{isEmail:!0}},password:{type:n.DataTypes.STRING,allowNull:!0},emailVerified:{type:n.DataTypes.BOOLEAN,defaultValue:!1},name:{type:n.DataTypes.STRING,allowNull:!0},image:{type:n.DataTypes.STRING,allowNull:!0},googleId:{type:n.DataTypes.STRING,allowNull:!0,unique:!0},settings:{type:n.DataTypes.JSONB,defaultValue:{sender:{name:"",address:"",city:"",postalCode:"",country:""},logoUrl:""}}},{timestamps:!0,hooks:{beforeCreate:async e=>{if(e.password){let a=await s().genSalt(10),t=await s().hash(e.password,a);e.password=t}},beforeUpdate:async e=>{if(e.changed("password")&&e.password){let a=await s().genSalt(10),t=await s().hash(e.password,a);e.password=t}}}});u.prototype.comparePassword=async function(e){return!!this.password&&await s().compare(e,this.password)};let c=u;r()}catch(e){r(e)}})},6075:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.d(a,{m:()=>o.default,n:()=>n.default});var n=t(1897),o=t(2198),s=e([n,o]);[n,o]=s.then?(await s)():s,r()}catch(e){r(e)}})},3857:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{default:()=>f});var n=t(3227),o=t.n(n),s=t(3598),i=t.n(s),l=t(2930),u=t(409),c=t(6075),d=t(9344),p=t.n(d),y=e([l,u,c]);[l,u,c]=y.then?(await y)():y;let g=()=>{let e=["GOOGLE_CLIENT_ID","GOOGLE_CLIENT_SECRET","JWT_SECRET","NEXTAUTH_SECRET"].filter(e=>!process.env[e]);if(e.length>0)throw console.error(`Missing required environment variables: ${e.join(", ")}`),Error(`Missing required environment variables: ${e.join(", ")}`);"your_jwt_secret_key_change_this_in_production"===process.env.JWT_SECRET&&console.error("WARNING: Using default JWT_SECRET in production environment!")},T=!1,m=null,h=async()=>m||(g(),m=(0,u.Dv)().then(e=>(T=e,e?console.log("Database initialized successfully for NextAuth"):console.error("Failed to initialize database for NextAuth"),e)).catch(e=>(console.error("Error initializing database for NextAuth:",e),!1))),w=async()=>{await h();let e=(0,l.default)(u.gk);return{providers:[i()({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""})],adapter:e,session:{strategy:"jwt",maxAge:2592e3},pages:{signIn:"/login",signOut:"/login",error:"/login"},callbacks:{async signIn({user:e,account:a,profile:t}){try{if(a?.provider!=="google")return!1;if(!T)return console.error("Database not initialized during sign-in attempt"),!1;if(e.email)try{let a=await c.n.findOne({where:{email:e.email}});a?!a.googleId&&t&&await a.update({googleId:t.sub,name:e.name||void 0,image:e.image||void 0,emailVerified:!0}):await c.n.create({email:e.email,name:e.name||void 0,image:e.image||void 0,googleId:t?t.sub:void 0,emailVerified:!0})}catch(e){return console.error("Database error during sign-in:",e),!1}return!0}catch(e){return console.error("Error in signIn callback:",e),!1}},async jwt({token:e,user:a}){try{if(a){e.userId=a.id;let t=process.env.JWT_SECRET;if(!t)throw console.error("JWT_SECRET is not defined"),Error("JWT_SECRET is not defined");let r=p().sign({id:a.id},t,{expiresIn:"7d"});e.customToken=r}return e}catch(a){return console.error("Error in jwt callback:",a),e}},async session({session:e,token:a}){try{return e.user&&a.userId&&(e.user.id=a.userId,a.customToken&&(e.customToken=a.customToken)),e}catch(a){return console.error("Error in session callback:",a),e}}},debug:!1}};async function f(e,a){let t=await w();return await o()(e,a,t)}r()}catch(e){r(e)}})},7153:(e,a)=>{var t;Object.defineProperty(a,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,a,t)=>{e.exports=t(145)}};var a=require("../../../webpack-api-runtime.js");a.C(e);var t=a(a.s=7692);module.exports=t})();